@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.mvc.Request
@import play.twirl.api.Html
@import testOnly.controllers.routes
@import essttp.rootmodel.TaxRegime
@import testOnly.views.html.TestOnlyLayout
@import requests.RequestSupport
@import uk.gov.hmrc.auth.core.{Enrolments, Enrolment}
@import uk.gov.hmrc.govukfrontend.views.html.components._

@this(
  testOnlyLayout: TestOnlyLayout,
  govukButton: GovukButton,
  formWithCSRF: FormWithCSRF,
  requestSupport: RequestSupport
)

@(taxRegime: TaxRegime, enrolments: Enrolments)(implicit request: Request[_])

@import requestSupport._

@title = @{
    "I am Pega Page"
}

@enrolmentRow(enrolment: Enrolment) = {
   <tr class="govuk-table__row">
     <td class="govuk-table__cell">@{enrolment.key}</td>
     <td class="govuk-table__cell">@{Html(enrolment.identifiers.map(_.key).mkString("<br/>"))}</td>
     <td class="govuk-table__cell">@{Html(enrolment.identifiers.map(_.value).mkString("<br/>"))}</td>
   </tr>
}

@testOnlyLayout(pageTitle = Some(title)) {

    <h1 class="govuk-heading-xl">@title</h1>
    <p class="govuk-body">Dummy PEGA page</p>

    <h2 class="govuk-heading-l">☆*:・ﾟ・*★IMPORTANT★*・ﾟ・:*☆</h2>

    <p class="govuk-body">Clicking continue will sign you out and prompt you to log in again.</p>

    <p class="govuk-body">You won’t be able to see this page again after continuing and clicking back.</p>

    <p class="govuk-body">Make a note of these enrolments in the current login - you’ll have to enter them again on the auth login stub page:</p>

    <table class="govuk-table">
        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">Enrolment Key</th>
                <th scope="col" class="govuk-table__header">Identifier Name</th>
                <th scope="col" class="govuk-table__header">Identifier Value</th>
            </tr>
        </thead>

        <tbody class="govuk-table__body">
            @{enrolments.enrolments.map(enrolmentRow)}
        </tbody>
    </table>

    @formWithCSRF(action = routes.PegaController.dummyPegaPageContinue(taxRegime)) {
        @govukButton(Button(
            content = Text("Continue"),
            attributes = Map("id" -> "continue")
        ))
    }

}
